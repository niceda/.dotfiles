# lf doc - https://godoc.org/github.com/gokcehan/lf
# lfrc example - https://github.com/gokcehan/lf/blob/master/etc/lfrc.example

# ========== General settings ==========

set shellopts '-eu'
set ifs "\n"
set scrolloff 10
set icons
set drawbox
set incsearch
set smartcase
set ignorecase
set anchorfind
set findlen 1
set tabstop 4
set info 'size'
# set preview
# set previewer ~/.config/lf/previewer
# set cleaner ~/.config/lf/cleaner
set dircounts

# ========== Commands ==========

cmd mkdir $mkdir -p "$(echo $* | tr ' ' '\ ')"

# Create a directory with the selected items
cmd new-folder-with-selection ${{
  set -f
  printf "Directory name: "
  read newd
  mkdir -- "$newd"
  mv -- $fx "$newd"
}}

cmd chmod ${{
  printf "\nMode Bits: "
  read ans
  for file in "$fx"
  do
    chmod $ans $file
  done
  lf -remote 'send reload'
}}

cmd extract ${{
  set -f
  case $f in
    *.tar.bz|*.tar.bz2|*.tbz|*.tbz2) tar xjvf $f;;
    *.tar.gz|*.tgz) tar xzvf $f;;
    *.tar.xz|*.txz) tar xJvf $f;;
    *.tar) tar xvf $f;;
    *.zip) unzip $f;;
    *.rar) unrar x $f;;
    *.7z) 7z x $f;;
    *) echo "Unsupported format";;
  esac
}}

cmd tar ${{
    set -f
    mkdir $1
    cp -r $fx $1
    tar czf $1.tar.gz $1
    rm -rf $1
}}

cmd zip ${{
    set -f
    mkdir $1
    cp -r $fx $1
    zip -r $1.zip $1
    rm -rf $1
}}

cmd trash %set -f; mv $fx ~/.trash

cmd select-all :unselect; invert

# Copy the file names (including extension) of the selections separated by \n
cmd copy-filename ${{
  names="$(echo $fx | tr ' ' '\n' | xargs -I{} basename {})"
  echo $names | tr ' ' '\n' | pbcopy
}}

# Copy the absolute paths of selections separated by \n
cmd copy-absolute-path ${{
  echo $fx | tr ' ' '\n' | pbcopy
}}

# Select the file or directory via fzf
cmd fzf-select ${{
  IFS=' '
  exclude=$(cat $HOME/exclude | sed 's/^/--exclude /' | tr '\n' ' ')
  select=$(fd --hidden --follow $exclude | fzf)
  lf -remote "send $id select $select"
}}

# cd into the selected directory via fzf
cmd fzf-cd ${{
  IFS=' '
  exclude=$(cat $HOME/exclude | sed 's/^/--exclude /' | tr '\n' ' ')
  select=$(fd --type d --hidden --follow $exclude | fzf)
  lf -remote "send $id cd $select"
}}

# ========== Mappings ==========

map <space>
map <tab> :toggle;down
map y
map yy copy
map yn copy-filename
map yP copy-absolute-path
map <enter> shell
map d
map dD delete
map dd cut
map dT trash
map <space>f fzf-select
# map <c-j> fzf-cd
map M push :mkdir<space>
map V push :!lvim<space>
map [ push hkl
map ] push hjl
map A rename # at the very end
map I push A<c-a> # at the very beginning
map r push A<c-u> # new rename
map ec push :zip<space>
map ex extract

# navigation
map <space><space> cd ~/dotfiles
map gh cd ~
map gd cd /mnt/c/Users/Fida/Desktop/
map gff cd ~/.config
map gfr cd ~/.config/ranger
map gfb cd ~/.config/bin
map gfv cd ~/.config/nvim
# map gfm cd ~/.config/mutt
map gfz cd ~/.config/zsh
map gft shell lvim ~/dotfiles/tmux/.tmux.conf
map gflg cd ~/.config/lazygit/
map ge cd /etc
map guu cd /usr
map gus cd /usr/share
map gp cd ~/prog
map gw cd /mnt/c/Users/Fida/Desktop/Pictures
map glv cd ~/.local/share/lunarvim/lvim
map gll cd ~/.local
map gflv cd ~/.config/lvim
